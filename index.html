<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!--    Include the purecss.io CSS files for formatting and responsive design-->
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/pure-min.css"
          integrity="sha384-4ZPLezkTZTsojWFhpdFembdzFudphhoOzIunR1wH6g1WQDzCAiPvDyitaK67mp0+" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/base-min.css">
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/grids-min.css">
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/grids-responsive-min.css">
    <!--    Make sure the width is equal to the device's native width-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="www/styles.css" rel="stylesheet" type="text/css"/>

    <!--    Get jQuery-->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>


    <title>Genghis Bot Battle System</title>
</head>
<body>
<!--Genghis Header-->
<div class="pure-g">
    <div class="pure-u-1-1">
        <h1>Genghis</h1>
        <h4>Bot Battle System</h4>
    </div>
</div>
<!--Live now Card-->
<div class="pure-g">
    <div class="pure-u-1-1">
        <div class="shadow">
            <!--            Group for the left list-->
            <div class="pure-g">
                <div class="pure-u-8-24">
                    <h2>Live now</h2>
                    <ul id="games_list">
                        <li><a href="index.html">Game 1</a></li>
                        <li><a href="index.html">Game 2</a></li>
                        <li><a href="index.html">Game 3</a></li>
                    </ul>
                </div>
                <!--                Group for the RHS preview-->
                <div class="pure-u-16-24">
                    <svg xmlns="http://www.w3.org/2000/svg">
                        <rect width="100%" height="100%" fill="lightgrey"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>
</div>
<!--What's this Card-->
<div class="pure-g">
    <div class="pure-u-1-1">
        <div class="shadow">
            <h2>What is This?</h2>
            <p>Using the Genghis Battle System by
                <a href="https://github.com/beyarkay">Boyd Kane</a>,
                bots built by Computer Science students compete for
                resources, trade, and fight each other across
                multiple different battlegrounds.</p>
        </div>
    </div>
</div>
<!--Make a bot Card-->
<div class="pure-g">
    <div class="pure-u-1-1">
        <div class="shadow">
            <h2>Make Your Own Bot</h2>
            To get started, you will need to copy some code from a
            <a href="https://github.com/beyarkay/genghis_client">GitHub
                repository</a> into an internet-connected sever (like UCT's
            nightmare server that all second-year students have access to). <br>
            <ol>
                <li>ssh into the UCT server:
                    <code>ssh &lt;YOUR_STUDENT_NUMBER&gt;@nightmare.cs.uct.ac.za</code>
                </li>
                <li>Make a public directory to host the bot script, and change into it:
                    <code>mkdir ~/public_html && cd ~/public_html</code>
                </li>
                <li>Get a copy of the scripts needed to setup your bot, and then
                    change into the newly created directory:
                    <code>git clone https://github.com/beyarkay/genghis_client.git && cd genghis_client</code>
                </li>
                <li>Run a script to get you started:
                    <code>python3 get_started.py</code>
                </li>
                <li>At the prompts, enter the server's URL:
                    <code>https://people.cs.uct.ac.za/~KNXBOY001/genghis_server/</code>
                    your URL:
                    <code>https://people.cs.uct.ac.za/~&lt;YOUR_STUDENT_NUMBER&gt;/genghis_client/</code>
                    and what you want your username to be:
                    <code>Username: &lt;CHOOSE A USERNAME&gt;</code>
                </li>
                <li>All done! Your bot will be included in the next game.
                </li>
            </ol>
        </div>
    </div>
</div>
<!--TODO Host a server Card-->
<!--<div class="pure-g">-->
<!--    <div class="pure-u-1-1">-->
<!--        <div class="shadow">-->
<!--            <h2>Host your own server</h2>-->
<!--            Anyone can host a genghis-based server, although this-->
<!--            requires a lot more knowledge of Python3 / Unix scripting -->
<!--            than just building a bot:-->
<!--            <ol>-->
<!--                <li>In a public directory, clone the git repo:-->
<!--                    <code>git clone https://github.com/beyarkay/genghis_server.git</code>-->
<!--                </li>-->
<!--                <li>Take note of the publicly accessible URL:-->
<!--                    <code>python3 get_started.py</code>-->
<!--                </li>-->
<!--                <li>At the prompts, enter the server's URL:-->
<!--                    <code>https://people.cs.uct.ac.za/~KNXBOY001/genghis_server/</code>-->
<!--                    your URL:-->
<!--                    <code>https://people.cs.uct.ac.za/~&lt;YOUR_STUDENT_NUMBER&gt;/genghis_client/</code>-->
<!--                    and what you want your username to be:-->
<!--                    <code>Username: &lt;CHOOSE A USERNAME&gt;</code>-->
<!--                </li>-->
<!--                <li>All done! Your bot will be included in the next game:-->
<!--                </li>-->
<!--            </ol>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
<script>
    function get_param(param, defaultvalue) {
        var urlparameter = defaultvalue;
        if(window.location.href.indexOf(param) > -1){
            let vars = {};
            let parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, 
                    function(m, key, value) {
                vars[key] = value;
            });
            return vars[param]
        }
        return defaultvalue;
    }

    console.log(get_param("game", "None"));
    console.log(get_param("follow", "None"));
    $.ajax({
        url: "server_state.json"
    }).done(data => {
        if (data && data['games']) {
            console.log("Data found: ", data['games']);
            // Update the list of games
            let ul = document.getElementById("games_list");
            ul.innerHTML = "";
            // Attempt to get the files for the bots / battlegrounds
            for (let i = 0; i < data['games'].length; i++) {
                let game = data['games'][i];
                let li = document.createElement("li");
                let a = document.createElement("a");
                a.setAttribute("href", "www/follow.html?game=" + game['game_dir'] + "&follow=none");
                a.innerHTML = game['game_dir'].replace('games/','');
                li.appendChild(a);
                ul.appendChild(li);
            }
        }
    });

    // $(document).ready(function () {
    //     $.ajaxSetup({cache: false});
    //     let interval = 250;
    //
    //     function update() {
    //         $.when($.ajax('games/*'))
    //             .then(function (stateResponse) {
    //                 //console.log(stateResponse);
    //
    //                 updateWithState(stateResponse);
    //
    //             }, function () {
    //                 console.log('Error while loading gamestate/layout');
    //             });
    //         setTimeout(update, interval);
    //     }
    //
    //     setTimeout(update, interval);
    //
    //
    // });
    // Update the Games list
    // Update the bots/battlegrounds list
    // Update the Live Now card
    // Update the Preview map
    // Go to the top and update it all again


</script>
</body>
</html>
